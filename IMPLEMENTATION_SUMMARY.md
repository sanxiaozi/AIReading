# ç™»å½•/æ³¨å†Œé¡µé¢å’Œç”¨æˆ·ä¸­å¿ƒå®ç°æ€»ç»“

## å®Œæˆçš„å·¥ä½œ

### 1. âœ… è®¤è¯çŠ¶æ€ç®¡ç† (AuthContext)
åˆ›å»ºäº† `src/contexts/AuthContext.tsx`ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
- **user** - å½“å‰ç”¨æˆ·ä¿¡æ¯
- **isAuthenticated** - æ˜¯å¦å·²ç™»å½•
- **isLoading** - åŠ è½½çŠ¶æ€
- **login(email, password, rememberMe)** - ç™»å½•æ–¹æ³•
- **register(email, password, username)** - æ³¨å†Œæ–¹æ³•
- **logout()** - ç™»å‡ºæ–¹æ³•
- **refreshUser()** - åˆ·æ–°ç”¨æˆ·ä¿¡æ¯

### 2. âœ… æ›´æ–°ç™»å½•/æ³¨å†Œé¡µé¢
- é›†æˆäº† **AuthContext**
- è¿æ¥åç«¯ API (`/api/auth/login`, `/api/auth/register`)
- å®ç°é”™è¯¯å¤„ç†ï¼ˆä¸­è‹±æ–‡ï¼‰
- æ·»åŠ  Loading çŠ¶æ€
- æˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ

**æ–‡ä»¶ä½ç½®**:
- `src/app/[locale]/login/LoginForm.tsx`
- `src/app/[locale]/register/RegisterForm.tsx`

### 3. âœ… åç«¯ API ç«¯ç‚¹
åˆ›å»ºäº†å®Œæ•´çš„è®¤è¯ APIï¼š

**å·²æœ‰çš„**:
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ

**æ–°å¢çš„**:
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### 4. âœ… å®¢æˆ·ç«¯è®¤è¯å·¥å…·
åˆ›å»ºäº† `src/lib/auth-client.ts`ï¼Œæä¾›ï¼š
- **login()** - ç™»å½• API è°ƒç”¨
- **register()** - æ³¨å†Œ API è°ƒç”¨
- **logout()** - ç™»å‡º API è°ƒç”¨
- **getCurrentUser()** - è·å–å½“å‰ç”¨æˆ·
- **isValidEmail()** - é‚®ç®±éªŒè¯
- **validatePasswordStrength()** - å¯†ç å¼ºåº¦éªŒè¯

### 5. âœ… ç”¨æˆ·ä¸­å¿ƒé¡µé¢
åˆ›å»ºäº† `src/app/[locale]/profile/ProfilePage.tsx`ï¼ŒåŒ…å«ï¼š
- ç”¨æˆ·ä¿¡æ¯å±•ç¤ºï¼ˆå¤´åƒã€ç”¨æˆ·åã€é‚®ç®±ï¼‰
- ä¼šå‘˜ç­‰çº§æ ‡è¯†ï¼ˆFree/Pro/Premiumï¼‰
- æ³¨å†Œæ—¶é—´ã€ä¸Šæ¬¡ç™»å½•æ—¶é—´
- å¿«é€Ÿç»Ÿè®¡ï¼ˆæ”¶è—æ•°ã€å¬ä¹¦å†å²ã€æ€»æ—¶é•¿ï¼‰
- æˆ‘çš„æ”¶è—åŒºåŸŸï¼ˆå ä½ï¼‰
- æœ€è¿‘å¬ä¹¦åŒºåŸŸï¼ˆå ä½ï¼‰
- é€€å‡ºç™»å½•æŒ‰é’®

**è·¯å¾„**: `/[locale]/profile`

### 6. âœ… å—ä¿æŠ¤è·¯ç”±ç»„ä»¶
åˆ›å»ºäº† `src/components/ProtectedRoute.tsx`ï¼š
- è‡ªåŠ¨æ£€æŸ¥è®¤è¯çŠ¶æ€
- æœªç™»å½•è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
- æ˜¾ç¤º Loading çŠ¶æ€

### 7. âœ… ç”¨æˆ·å¯¼èˆªç»„ä»¶
åˆ›å»ºäº† `src/components/UserNav.tsx`ï¼š
- æœªç™»å½•ï¼šæ˜¾ç¤º"ç™»å½•"å’Œ"æ³¨å†Œ"æŒ‰é’®
- å·²ç™»å½•ï¼šæ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œç”¨æˆ·å
- ç‚¹å‡»è·³è½¬åˆ°ç”¨æˆ·ä¸­å¿ƒ

### 8. âœ… å›½é™…åŒ–ç¿»è¯‘
æ›´æ–°äº† `src/i18n/messages/` ä¸­çš„ç¿»è¯‘æ–‡ä»¶ï¼š

**æ–°å¢ç¿»è¯‘é”®**:
```json
{
  "common": {
    "loading": "Loading... / åŠ è½½ä¸­..."
  },
  "profile": {
    "title": "My Profile / æˆ‘çš„ä¸­å¿ƒ",
    "backToHome": "Back to Home / è¿”å›é¦–é¡µ",
    "logout": "Logout / é€€å‡ºç™»å½•",
    "favorites": "Favorites / æ”¶è—",
    "listenHistory": "Listen History / å¬ä¹¦å†å²",
    // ... æ›´å¤š
  }
}
```

### 9. âœ… æ ¹å¸ƒå±€é…ç½®
åˆ›å»ºäº† `src/app/layout.tsx`ï¼ŒåŒ…è£¹ **AuthProvider**ï¼Œä½¿æ•´ä¸ªåº”ç”¨éƒ½èƒ½è®¿é—®è®¤è¯çŠ¶æ€ã€‚

### 10. âœ… é…ç½®ä¼˜åŒ–
ä¿®æ”¹äº† `next.config.ts`ï¼š
- ç§»é™¤ `output: "export"` é…ç½®ï¼ˆæ”¯æŒ API è·¯ç”±ï¼‰
- ä¿ç•™ `trailingSlash: true`

## æŠ€æœ¯ç»†èŠ‚

### Token ç®¡ç†
- Token å­˜å‚¨åœ¨ **localStorage** (`aireading_token`)
- API è¯·æ±‚æ—¶é€šè¿‡ **Authorization header** å‘é€ (`Bearer <token>`)
- æ”¯æŒä» cookie å’Œ header ä¸¤ç§æ–¹å¼è·å– token

### é”™è¯¯å¤„ç†
- å‹å¥½çš„ä¸­è‹±æ–‡é”™è¯¯æç¤º
- è¡¨å•å‰ç«¯éªŒè¯
- API é”™è¯¯æ•è·å’Œå±•ç¤º

### Loading çŠ¶æ€
- ç™»å½•/æ³¨å†Œæäº¤æ—¶æ˜¾ç¤º Loading
- é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºéª¨æ¶å±
- ç”¨æˆ·å¯¼èˆªæ˜¾ç¤ºåŠ è½½åŠ¨ç”»

### ç§»åŠ¨ç«¯é€‚é…
- ä½¿ç”¨ Tailwind çš„å“åº”å¼ç±» (`md:`, `lg:`)
- ç”¨æˆ·ä¸­å¿ƒåœ¨ç§»åŠ¨ç«¯è‡ªåŠ¨è°ƒæ•´å¸ƒå±€
- è¡¨å•åœ¨å°å±å¹•ä¸Šä¼˜åŒ–æ˜¾ç¤º

## ä½¿ç”¨æ–¹æ³•

### 1. åœ¨é¡µé¢ä¸­ä½¿ç”¨è®¤è¯
```tsx
'use client';
import { useAuth } from '@/contexts/AuthContext';

export default function MyPage() {
  const { user, isAuthenticated, login, logout } = useAuth();
  
  if (!isAuthenticated) {
    return <div>Please login</div>;
  }
  
  return <div>Welcome, {user.username}!</div>;
}
```

### 2. ä½¿ç”¨å—ä¿æŠ¤è·¯ç”±
```tsx
import ProtectedRoute from '@/components/ProtectedRoute';

export default function PrivatePage() {
  return (
    <ProtectedRoute redirectTo="/en/login">
      <div>Private content here</div>
    </ProtectedRoute>
  );
}
```

### 3. åœ¨å¯¼èˆªæ ä¸­ä½¿ç”¨
```tsx
import UserNav from '@/components/UserNav';

export default function Navbar({ locale }) {
  return (
    <nav>
      <UserNav locale={locale} />
    </nav>
  );
}
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

### å¾…å®ç°åŠŸèƒ½
1. **æ”¶è—åŠŸèƒ½** - ä¹¦ç±æ”¶è—/å–æ¶ˆæ”¶è—
2. **å¬ä¹¦å†å²** - è®°å½•å¬ä¹¦è¿›åº¦å’Œå†å²
3. **ä¸ªäººè®¾ç½®** - ä¿®æ”¹ç”¨æˆ·åã€å¤´åƒã€è¯­è¨€åå¥½
4. **å¯†ç ç®¡ç†** - å¿˜è®°å¯†ç ã€ä¿®æ”¹å¯†ç 
5. **ç¤¾äº¤ç™»å½•** - Googleã€å¾®ä¿¡ç­‰ç¬¬ä¸‰æ–¹ç™»å½•
6. **é‚®ç®±éªŒè¯** - æ³¨å†Œåé‚®ç®±éªŒè¯æµç¨‹

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ React Query/SWR ç¼“å­˜ç”¨æˆ·æ•°æ®
- ä¼˜åŒ–é¦–å±åŠ è½½é€Ÿåº¦
- æ·»åŠ éª¨æ¶å±åŠ¨ç”»

## æµ‹è¯•

### æœ¬åœ°æµ‹è¯•
```bash
npm run dev
```

è®¿é—®:
- ç™»å½•é¡µ: http://localhost:3000/en/login
- æ³¨å†Œé¡µ: http://localhost:3000/en/register
- ç”¨æˆ·ä¸­å¿ƒ: http://localhost:3000/en/profile

### æµ‹è¯•ç”¨æˆ·æ³¨å†Œæµç¨‹
1. è®¿é—®æ³¨å†Œé¡µ
2. å¡«å†™é‚®ç®±ã€å¯†ç ã€ç”¨æˆ·å
3. å‹¾é€‰åŒæ„æ¡æ¬¾
4. ç‚¹å‡»"åˆ›å»ºè´¦æˆ·"
5. æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ

### æµ‹è¯•ç”¨æˆ·ç™»å½•æµç¨‹
1. è®¿é—®ç™»å½•é¡µ
2. å¡«å†™é‚®ç®±å’Œå¯†ç 
3. å¯é€‰å‹¾é€‰"è®°ä½æˆ‘"
4. ç‚¹å‡»"ç™»å½•"
5. ç™»å½•æˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ

### æµ‹è¯•ç”¨æˆ·ä¸­å¿ƒ
1. ç™»å½•åè®¿é—® `/profile`
2. æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
3. ç‚¹å‡»"é€€å‡ºç™»å½•"æŒ‰é’®

## æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx                    # æ ¹å¸ƒå±€ï¼ˆåŒ…å« AuthProviderï¼‰
â”‚   â”œâ”€â”€ [locale]/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ LoginForm.tsx        # âœ… å·²æ›´æ–°
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RegisterForm.tsx     # âœ… å·²æ›´æ–°
â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚       â”œâ”€â”€ page.tsx             # âœ… æ–°å¢
â”‚   â”‚       â””â”€â”€ ProfilePage.tsx      # âœ… æ–°å¢
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ auth/
â”‚           â”œâ”€â”€ login/route.ts       # ç™»å½• API
â”‚           â”œâ”€â”€ register/route.ts    # æ³¨å†Œ API
â”‚           â”œâ”€â”€ me/route.ts          # âœ… æ–°å¢ - è·å–å½“å‰ç”¨æˆ·
â”‚           â””â”€â”€ logout/route.ts      # âœ… æ–°å¢ - ç™»å‡º
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ProtectedRoute.tsx           # âœ… æ–°å¢ - å—ä¿æŠ¤è·¯ç”±
â”‚   â””â”€â”€ UserNav.tsx                  # âœ… æ–°å¢ - ç”¨æˆ·å¯¼èˆª
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx              # âœ… æ–°å¢ - è®¤è¯çŠ¶æ€ç®¡ç†
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth.ts                      # æœåŠ¡ç«¯è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ auth-client.ts               # âœ… æ–°å¢ - å®¢æˆ·ç«¯è®¤è¯å·¥å…·
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ user.ts                  # ç”¨æˆ·æ•°æ®æ¨¡å‹
â””â”€â”€ i18n/
    â””â”€â”€ messages/
        â”œâ”€â”€ en.json                  # âœ… å·²æ›´æ–° - è‹±æ–‡ç¿»è¯‘
        â””â”€â”€ zh.json                  # âœ… å·²æ›´æ–° - ä¸­æ–‡ç¿»è¯‘
```

## æ€»ç»“

âœ… æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼š
1. âœ… ç™»å½•/æ³¨å†Œé¡µé¢å·²è¿æ¥åç«¯ API
2. âœ… AuthContext è®¤è¯çŠ¶æ€ç®¡ç†å·²å®ç°
3. âœ… ç”¨æˆ·ä¸­å¿ƒé¡µé¢å·²åˆ›å»ºï¼ˆåŸºç¡€ç‰ˆï¼‰
4. âœ… å—ä¿æŠ¤è·¯ç”±å·²å®ç°
5. âœ… ç”¨æˆ·å¯¼èˆªç»„ä»¶å·²åˆ›å»º
6. âœ… é”™è¯¯å¤„ç†å‹å¥½ï¼ˆä¸­è‹±æ–‡ï¼‰
7. âœ… Loading çŠ¶æ€æ˜æ˜¾
8. âœ… ç§»åŠ¨ç«¯é€‚é…å®Œæˆ

é¡¹ç›®å·²æˆåŠŸå¯åŠ¨ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•ï¼ğŸ‰
