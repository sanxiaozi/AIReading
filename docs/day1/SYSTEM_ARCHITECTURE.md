# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡ - AiReading

## âš™ï¸ åç«¯å¼€å‘äº§å‡ºç‰© | Day 1

---

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Web App â”‚  â”‚   PWA   â”‚  â”‚ Mobile  â”‚  â”‚   API   â”‚       â”‚
â”‚  â”‚ (Next.js)â”‚ â”‚         â”‚  â”‚ Browser â”‚  â”‚ Clients â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CDN / Edge Layer                        â”‚
â”‚                   (Cloudflare CDN)                          â”‚
â”‚         é™æ€èµ„æº / éŸ³é¢‘æ–‡ä»¶ / å›¾ç‰‡ / é¡µé¢ç¼“å­˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (API)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              API Server (Hono/Express)               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Auth   â”‚ â”‚  Books  â”‚ â”‚  User   â”‚ â”‚ Payment â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Service â”‚ â”‚ Service â”‚ â”‚ Service â”‚ â”‚ Service â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    Cloudflare Workers / Railway             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  PostgreSQL â”‚  â”‚    Redis    â”‚  â”‚ Cloudflare  â”‚        â”‚
â”‚  â”‚  (Neon/     â”‚  â”‚   (Upstash) â”‚  â”‚     R2      â”‚        â”‚
â”‚  â”‚   Supabase) â”‚  â”‚   ç¼“å­˜/ä¼šè¯  â”‚  â”‚  éŸ³é¢‘å­˜å‚¨   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Stripe  â”‚  â”‚ OpenAI  â”‚  â”‚ Resend  â”‚  â”‚ Sentry  â”‚       â”‚
â”‚  â”‚ (æ”¯ä»˜)  â”‚  â”‚  (TTS)  â”‚  â”‚ (é‚®ä»¶)  â”‚  â”‚ (ç›‘æ§)  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€æœ¯é€‰å‹

### å‰ç«¯
| æŠ€æœ¯ | é€‰å‹ | ç†ç”± |
|------|------|------|
| æ¡†æ¶ | Next.js 14 | SSG + æ€§èƒ½ä¼˜ç§€ |
| è¯­è¨€ | TypeScript | ç±»å‹å®‰å…¨ |
| æ ·å¼ | Tailwind CSS | å¼€å‘æ•ˆç‡é«˜ |
| çŠ¶æ€ | Zustand | è½»é‡çº§ |
| éƒ¨ç½² | Cloudflare Pages | å…¨çƒCDN + å…è´¹ |

### åç«¯
| æŠ€æœ¯ | é€‰å‹ | ç†ç”± |
|------|------|------|
| è¿è¡Œæ—¶ | Node.js / Bun | ç”Ÿæ€æˆç†Ÿ |
| æ¡†æ¶ | Hono | è½»é‡ + Edgeå…¼å®¹ |
| ORM | Drizzle | ç±»å‹å®‰å…¨ + æ€§èƒ½ |
| è®¤è¯ | Lucia Auth | çµæ´» + å®‰å…¨ |
| éƒ¨ç½² | Cloudflare Workers | ä½å»¶è¿Ÿ + å…è´¹é¢åº¦ |

### æ•°æ®å­˜å‚¨
| éœ€æ±‚ | é€‰å‹ | ç†ç”± |
|------|------|------|
| ä¸»æ•°æ®åº“ | Neon PostgreSQL | Serverless + å…è´¹ |
| ç¼“å­˜ | Upstash Redis | Serverless + ä½å»¶è¿Ÿ |
| æ–‡ä»¶å­˜å‚¨ | Cloudflare R2 | é›¶å‡ºç«™è´¹ç”¨ |
| æœç´¢ | Meilisearch | å¼€æº + ä¸­æ–‡æ”¯æŒ |

---

## æ•°æ®åº“Schema

### users ç”¨æˆ·è¡¨
```sql
CREATE TABLE users (
  id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email         VARCHAR(255) UNIQUE,
  phone         VARCHAR(20) UNIQUE,
  password_hash VARCHAR(255),
  name          VARCHAR(100),
  avatar_url    VARCHAR(500),
  locale        VARCHAR(10) DEFAULT 'en',
  created_at    TIMESTAMP DEFAULT NOW(),
  updated_at    TIMESTAMP DEFAULT NOW()
);
```

### subscriptions è®¢é˜…è¡¨
```sql
CREATE TABLE subscriptions (
  id                    UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id               UUID REFERENCES users(id),
  plan                  VARCHAR(20) NOT NULL, -- free/pro/team
  status                VARCHAR(20) NOT NULL, -- active/canceled/past_due
  stripe_customer_id    VARCHAR(100),
  stripe_subscription_id VARCHAR(100),
  current_period_start  TIMESTAMP,
  current_period_end    TIMESTAMP,
  created_at            TIMESTAMP DEFAULT NOW()
);
```

### listening_history æ”¶å¬å†å²
```sql
CREATE TABLE listening_history (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id         UUID REFERENCES users(id),
  book_id         INTEGER NOT NULL,
  summary_type    VARCHAR(20), -- short/medium/long
  progress_seconds INTEGER DEFAULT 0,
  total_seconds   INTEGER,
  completed       BOOLEAN DEFAULT FALSE,
  last_played_at  TIMESTAMP DEFAULT NOW(),
  created_at      TIMESTAMP DEFAULT NOW()
);
```

### favorites æ”¶è—è¡¨
```sql
CREATE TABLE favorites (
  id         UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id    UUID REFERENCES users(id),
  book_id    INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, book_id)
);
```

### notes ç¬”è®°è¡¨
```sql
CREATE TABLE notes (
  id                UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id           UUID REFERENCES users(id),
  book_id           INTEGER NOT NULL,
  summary_type      VARCHAR(20),
  timestamp_seconds INTEGER,
  content           TEXT NOT NULL,
  created_at        TIMESTAMP DEFAULT NOW(),
  updated_at        TIMESTAMP DEFAULT NOW()
);
```

---

## APIè®¾è®¡

### è®¤è¯æ¨¡å— `/api/v1/auth`
```
POST   /register        # æ³¨å†Œ
POST   /login           # ç™»å½•
POST   /logout          # ç™»å‡º
POST   /refresh         # åˆ·æ–°Token
POST   /forgot-password # å¿˜è®°å¯†ç 
POST   /reset-password  # é‡ç½®å¯†ç 
GET    /me              # å½“å‰ç”¨æˆ·
POST   /oauth/google    # Googleç™»å½•
POST   /oauth/apple     # Appleç™»å½•
```

### ä¹¦ç±æ¨¡å— `/api/v1/books`
```
GET    /                # ä¹¦ç±åˆ—è¡¨ (åˆ†é¡µ+ç­›é€‰)
GET    /:id             # ä¹¦ç±è¯¦æƒ…
GET    /:id/audio/:type # éŸ³é¢‘URL (short/medium/long)
GET    /categories      # åˆ†ç±»åˆ—è¡¨
GET    /search          # æœç´¢
GET    /recommendations # æ¨è
```

### ç”¨æˆ·æ•°æ® `/api/v1/user`
```
GET    /history         # æ”¶å¬å†å²
POST   /history         # æ·»åŠ å†å²
GET    /favorites       # æ”¶è—åˆ—è¡¨
POST   /favorites       # æ·»åŠ æ”¶è—
DELETE /favorites/:id   # åˆ é™¤æ”¶è—
PUT    /progress/:bookId # æ›´æ–°è¿›åº¦
GET    /notes           # ç¬”è®°åˆ—è¡¨
POST   /notes           # æ·»åŠ ç¬”è®°
PUT    /notes/:id       # æ›´æ–°ç¬”è®°
DELETE /notes/:id       # åˆ é™¤ç¬”è®°
```

### è®¢é˜…æ¨¡å— `/api/v1/subscription`
```
GET    /                # è®¢é˜…çŠ¶æ€
POST   /                # åˆ›å»ºè®¢é˜…
PUT    /                # æ›´æ–°è®¢é˜…
DELETE /                # å–æ¶ˆè®¢é˜…
POST   /webhook         # Stripe Webhook
```

---

## éƒ¨ç½²æ¶æ„

```
ç”Ÿäº§ç¯å¢ƒ:
â”œâ”€â”€ Frontend: Cloudflare Pages (aireading.com)
â”œâ”€â”€ API: Cloudflare Workers (api.aireading.com)
â”œâ”€â”€ Database: Neon PostgreSQL (us-east-1)
â”œâ”€â”€ Cache: Upstash Redis (global)
â”œâ”€â”€ Storage: Cloudflare R2 (global)
â””â”€â”€ CDN: Cloudflare (å…¨çƒèŠ‚ç‚¹)

å¼€å‘ç¯å¢ƒ:
â”œâ”€â”€ Frontend: localhost:3000
â”œâ”€â”€ API: localhost:8787
â”œâ”€â”€ Database: Neon (dev branch)
â””â”€â”€ Storage: Local filesystem
```

---

## å®‰å…¨æªæ–½

| å±‚é¢ | æªæ–½ |
|------|------|
| ä¼ è¾“ | å…¨ç«™HTTPS, TLS 1.3 |
| è®¤è¯ | JWT + Refresh Token, çŸ­æœŸæœ‰æ•ˆ |
| å¯†ç  | bcryptå“ˆå¸Œ, ç›å€¼ |
| API | Rate Limiting (100/min/IP) |
| æ•°æ® | æ•æ„Ÿå­—æ®µAESåŠ å¯† |
| è¾“å…¥ | å‚æ•°æ ¡éªŒ, SQLæ³¨å…¥é˜²æŠ¤ |
| XSS | CSPå¤´, è¾“å‡ºè½¬ä¹‰ |
| CSRF | SameSite Cookie |

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0*
*åˆ›å»ºæ—¥æœŸ: 2026-01-28*
*è´Ÿè´£äºº: åç«¯å¼€å‘*
